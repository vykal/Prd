<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chess vs Computer</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      background-color: #f0f0f0;
    }
    #board {
      width: 400px;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/1.0.0-beta.1/chess.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/chessboard.min.js"></script>
  <script>
    // Include Stockfish engine
    const stockfish = new Worker("https://raw.githubusercontent.com/niklasf/stockfish.wasm/master/src/stockfish.wasm.js");

    // Initialize Chessboard and Chess.js
    let board;
    const chess = new Chess();

    function onDragStart(source, piece) {
      if (chess.game_over()) return false;
      if (chess.turn() === "w" && piece.startsWith("b")) return false;
      if (chess.turn() === "b" && piece.startsWith("w")) return false;
    }

    function onDrop(source, target) {
      const move = chess.move({ from: source, to: target, promotion: "q" });

      if (!move) return "snapback";

      updateBoard();

      if (!chess.game_over()) {
        setTimeout(makeComputerMove, 500);
      }
    }

    function onSnapEnd() {
      board.position(chess.fen());
    }

    function updateBoard() {
      board.position(chess.fen());
    }

    function makeComputerMove() {
      stockfish.postMessage(`position fen ${chess.fen()}`);
      stockfish.postMessage("go depth 15");

      stockfish.onmessage = (event) => {
        if (event.data.startsWith("bestmove")) {
          const move = event.data.split(" ")[1];
          chess.move({ from: move.slice(0, 2), to: move.slice(2, 4), promotion: "q" });
          updateBoard();
        }
      };
    }

    document.addEventListener("DOMContentLoaded", () => {
      board = Chessboard("board", {
        draggable: true,
        position: "start",
        onDragStart,
        onDrop,
        onSnapEnd,
      });
    });
  </script>
</head>
<body>
  <div id="board"></div>
</body>
</html>
