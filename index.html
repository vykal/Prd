<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Video Chat</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }
        video {
            width: 45%;
            border: 2px solid #333;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <video id="localVideo" autoplay muted playsinline></video>
    <div id="remoteVideos"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.16.0/firebase-app.js";
        import { getDatabase, ref, set, onValue, remove } from "https://www.gstatic.com/firebasejs/9.16.0/firebase-database.js";

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB-sXXU2-dWigTrpYp1hnWbDjqqJ2gr0Yw",
            authDomain: "videjo-d0996.firebaseapp.com",
            databaseURL: "https://videjo-d0996-default-rtdb.firebaseio.com/",
            projectId: "videjo-d0996",
            storageBucket: "videjo-d0996.appspot.com",
            messagingSenderId: "175126755237",
            appId: "1:175126755237:web:72a635961214f3532bda4c",
            measurementId: "G-1MG4Q7CBDE"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const localVideo = document.getElementById("localVideo");
        const remoteVideosContainer = document.getElementById("remoteVideos");

        // Generate unique ID for the user
        const userId = `user-${Math.random().toString(36).substring(2, 15)}`;

        let localStream;

        // Access local camera
        async function startCamera() {
            try {
                localStream = await navigator.mediaDevices.getUserMedia({ video: true });
                localVideo.srcObject = localStream;

                // Save user stream to Firebase
                set(ref(db, `users/${userId}`), { 
                    stream: true 
                });

                // Remove user from database when they leave
                window.addEventListener("beforeunload", () => {
                    remove(ref(db, `users/${userId}`));
                });
            } catch (err) {
                console.error("Error accessing camera:", err);
            }
        }

        startCamera();

        // Listen for other users' streams
        onValue(ref(db, "users"), (snapshot) => {
            const users = snapshot.val() || {};
            remoteVideosContainer.innerHTML = ""; // Clear existing videos

            Object.keys(users).forEach((key) => {
                if (key !== userId) {
                    const video = document.createElement("video");
                    video.autoplay = true;
                    video.playsinline = true;

                    // For demo purposes, we don't have real streams from others yet
                    video.textContent = `Placeholder for ${key}`;
                    remoteVideosContainer.appendChild(video);
                }
            });
        });
    </script>
</body>
</html>
